{% extends "base.html" %}

{% block title %}m4brew • Settings{% endblock %}

{% block extra_head %}
<style>
  .stack {
    display: grid;
    gap: 14px;
    padding: 6px;
  }

  .setting-row {
    display: grid;
    grid-template-columns: var(--label-w) 1fr; /* ✅ matches Tasks step pill width */
    gap: 14px;
    align-items: center;
    padding: 16px;
    border-radius: var(--radius);
    background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.02));
    border: 1px solid rgba(255,255,255,.10);
    box-shadow: 0 10px 26px rgba(0,0,0,.22);
  }

  @media (max-width: 820px) {
    .setting-row { grid-template-columns: 1fr; }
    .label-pill { width: 100%; }
  }

  .field {
    width: 100%;
    height: var(--pill-h);        /* ✅ same as pills/buttons */
    padding: 0 var(--pill-pad-x);
    border-radius: 999px;
    border: 1px solid rgba(255,255,255,.12);
    background: rgba(0,0,0,.18);
    color: var(--text);
    outline: none;
  }

  .actions {
    display:flex;
    justify-content:flex-end;
    padding: 6px;
  }
</style>
{% endblock %}

{% block content %}
  <div class="card">
    <form method="post" action="/settings" id="settingsForm">
      <div class="stack">

        <div class="setting-row">
          <div class="label-pill">select source folder</div>
          <input class="field" id="root_folder" type="text" name="root_folder"
                 placeholder="/mnt/remotes/.../Audiobooks"
                 value="{{ settings.get('root_folder','') if settings else '' }}">
        </div>

        <div class="setting-row">
          <div class="label-pill">select audio tracks</div>
          <select class="field" id="audio_mode" name="audio_mode">
            {% set am = (settings.get("audio_mode") if settings else "match") %}
            <option value="match" {% if am == "match" %}selected{% endif %}>match</option>
            <option value="mono" {% if am == "mono" %}selected{% endif %}>mono</option>
            <option value="stereo" {% if am == "stereo" %}selected{% endif %}>stereo</option>
          </select>
        </div>

        <div class="setting-row">
          <div class="label-pill">select bitrate (kbps)</div>
          {% set br = (settings.get("bitrate", 64) if settings else 64) %}
          <select class="field" id="bitrate" name="bitrate">
            <option value="match">match (coming soon)</option>
            {% for v in [32,48,64,80,96,112,128,160,192,224,256,320] %}
              <option value="{{v}}" {% if br == v %}selected{% endif %}>{{v}}</option>
            {% endfor %}
          </select>
        </div>

        <div class="actions">
          <button class="btn primary" type="submit">Save</button>
        </div>

      </div>
    </form>
  </div>
{% endblock %}

{% block extra_js %}
<script>
  document.getElementById("settingsForm").addEventListener("submit", (e) => {
    const br = document.getElementById("bitrate").value;
    if (br === "match") {
      e.preventDefault();
      alert('Bitrate "match" isn’t wired up yet — pick a number for now.');
    }
  });
</script>
{% endblock %}
