{% extends "base.html" %}

{% block title %}m4brew • Settings{% endblock %}

{% block extra_head %}
<style>
  /* Settings page: side-by-side rows (pill + field), matched to Tasks pill width */
  .stack {
    display: grid;
    gap: 14px;
    padding: 6px;
  }

  .setting-row {
    display: grid;
    grid-template-columns: var(--label-w) 1fr; /* ✅ exact same width as step pills */
    gap: 14px;
    align-items: center;
    padding: 16px;
    border-radius: var(--radius);
    background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.02));
    border: 1px solid rgba(255,255,255,.10);
    box-shadow: 0 10px 26px rgba(0,0,0,.22);
  }

  @media (max-width: 720px) {
    .setting-row { grid-template-columns: 1fr; }
  }

  /* Use global pill styling from base.html (same height/width/centering everywhere)
     but keep it safe in case of template overrides */
  .label-pill {
    height: var(--pill-h);
    width: 100%;
    display: inline-flex;
    align-items: center;
    justify-content: center; /* ✅ centred like you want */
    padding: 0 var(--pill-pad-x);
    border-radius: 999px;
    font-weight: 650;
    letter-spacing: .2px;
    line-height: 1;
    background: rgba(124,92,255,.18);
    border: 1px solid rgba(124,92,255,.32);
    color: rgba(233,237,243,.92);
    box-shadow: 0 10px 22px rgba(0,0,0,.18);
  }

  /* Inputs/selects match pill height + typography */
  .field {
    width: 100%;
    height: var(--pill-h);
    border-radius: 999px;
    padding: 0 14px;
    border: 1px solid rgba(255,255,255,.12);
    background: rgba(0,0,0,.18);
    color: var(--text);
    outline: none;
    line-height: 1;
  }

  /* Some browsers ignore line-height on select; this helps vertical centring */
  select.field {
    padding-right: 42px;
  }
</style>
{% endblock %}

{% block content %}
  <div class="card">
    <form method="post" action="/settings" id="settingsForm">
      <div class="stack">

        <div class="setting-row">
          <div class="label-pill">select source folder</div>
          <input class="field" id="root_folder" type="text" name="root_folder"
                 placeholder="/mnt/remotes/.../Audiobooks"
                 value="{{ settings.get('root_folder','') if settings else '' }}">
        </div>

        <div class="setting-row">
          <div class="label-pill">select audio tracks</div>
          <select class="field" id="audio_mode" name="audio_mode">
            {% set am = (settings.get("audio_mode") if settings else "match") %}
            <option value="match" {% if am == "match" %}selected{% endif %}>match</option>
            <option value="mono" {% if am == "mono" %}selected{% endif %}>mono</option>
            <option value="stereo" {% if am == "stereo" %}selected{% endif %}>stereo</option>
          </select>
        </div>

        <div class="setting-row">
          <div class="label-pill">select bitrate (kbps)</div>
          {% set br = (settings.get("bitrate", 96) if settings else 96) %}
          <select class="field" id="bitrate" name="bitrate">
            {% for v in [32,48,64,80,96,112,128,160,192,224,256,320] %}
              <option value="{{v}}" {% if br == v %}selected{% endif %}>{{v}}</option>
            {% endfor %}
          </select>
        </div>

      </div>
    </form>
  </div>
{% endblock %}

{% block extra_js %}
<script>
  // Auto-save (no save button / no "saved" pill)
  const form = document.getElementById("settingsForm");
  let t = null;

  function autosave() {
    if (t) clearTimeout(t);
    t = setTimeout(async () => {
      try {
        const fd = new FormData(form);
        await fetch("/settings", { method: "POST", body: fd });
      } catch (e) {}
    }, 250);
  }

  form.addEventListener("input", autosave);
  form.addEventListener("change", autosave);
</script>
{% endblock %}
