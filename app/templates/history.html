{% extends "base.html" %}

{% block title %}m4brew · History{% endblock %}

{% block content %}
  <div class="card">
    <div style="display:flex; justify-content:flex-end; gap:12px; flex-wrap:wrap; margin-bottom: 10px;">
      <a class="btn" href="/history/download">Download</a>
      <form method="post" action="/history/clear" style="margin:0;">
        <button class="btn danger" type="submit">Clear history</button>
      </form>
    </div>

    <table>
      <thead>
        <tr>
          <th>Status</th>
          <th>When</th>
          <th>Mode</th>
          <th>Dry</th>
          <th>Runtime</th>
          <th>Created</th>
          <th>Skipped</th>
          <th>Failed</th>
          <th></th>
        </tr>
      </thead>

      <tbody>
        {% if count == 0 %}
          <tr>
            <td colspan="9" class="muted">No history yet — run a job and it will appear here.</td>
          </tr>
        {% else %}
          {% for r in runs %}
          <tr>
            <td>
              {% if r.success %}
                ✅
              {% else %}
                ❌
              {% endif %}
            </td>
            <td class="mono">{{ r.ts_human }}</td>
            <td class="mono">{{ r.mode }}</td>
            <td class="mono">{{ "true" if r.dry_run else "false" }}</td>
            <td class="mono">{{ r.runtime_s if r.runtime_s is not none else "—" }}</td>
            <td class="mono">{{ r.created if r.created is not none else "—" }}</td>
            <td class="mono">{{ r.skipped if r.skipped is not none else "—" }}</td>
            <td class="mono">{{ r.failed if r.failed is not none else "—" }}</td>
            <td style="text-align:right;">
              <a class="btn" href="/history/{{ r.idx }}">View</a>
            </td>
          </tr>
          {% endfor %}
        {% endif %}
      </tbody>
    </table>
  </div>
{% endblock %}
