{% extends "base.html" %}
{% block title %}m4brew • History{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{{ url_for('static', filename='history.css') }}">
{% endblock %}

{% block content %}
<div class="card">

  <div class="history-top">
    <a class="btn" href="/history/download">Download all</a>
    <form method="post" action="/history/clear" style="margin:0;">
      <button class="btn danger" type="submit">Clear history</button>
    </form>
  </div>

  {% if runs and runs|length %}
    <table>
      <thead>
        <tr>
          <th>Status</th>
          <th>When</th>
          <th>Mode</th>
          <th>Dry</th>
          <th>Runtime</th>
          <th>Created</th>
          <th>Skipped</th>
          <th>Failed</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for r in runs %}
          <tr>
            <td><span class="status">{% if r.success %}✓{% else %}!{% endif %}</span></td>
            <td class="when mono-small">{{ r.ts_human }}</td>
            <td class="mono-small">{{ r.mode }}</td>
            <td class="mono-small">{{ r.dry_run }}</td>
            <td class="mono-small">{{ r.runtime_s }}</td>
            <td class="mono-small">{{ r.created }}</td>
            <td class="mono-small">{{ r.skipped }}</td>
            <td class="mono-small">{{ r.failed }}</td>
            <td><a class="btn" href="/history/{{ r.idx }}">View</a></td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p class="muted">No history yet — run a job and it will appear here.</p>
  {% endif %}

</div>
{% endblock %}
