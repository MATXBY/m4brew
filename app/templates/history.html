{% extends "base.html" %}
{% block title %}m4brew • History{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{{ url_for('static', filename='history.css') }}">
{% endblock %}

{% block content %}
<div class="card card--history">
  <div class="history-stack">

    <div class="history-top">
      <a class="btn primary" href="/history/download">Download all</a>

      <form method="post" action="/history/clear" onsubmit="return confirm('Clear history?');">
        <button class="btn danger" type="submit">Clear history</button>
      </form>
    </div>

    {% if not runs or runs|length == 0 %}
      <div class="history-empty">No history entries found (yet).</div>
    {% else %}
      <div class="history-table-wrap">
        <table class="history-table">
          <thead>
            <tr>
              <th>Status</th>
              <th>When</th>
              <th>Mode</th>
              <th>Run type</th>
              <th>Runtime</th>
              <th>Completed</th>
              <th>Skipped</th>
              <th>Failed</th>
              <th></th>
            </tr>
          </thead>

          <tbody>
          {% for r in runs %}
            <tr>
              <td class="status {{ 'ok' if r.success else 'bad' }}">
                {{ '✓' if r.success else '×' }}
              </td>

              <td>{{ r.ts_human }}</td>
              <td>{{ r.mode_label }}</td>
              <td>{{ 'Test' if r.dry_run else 'Active' }}</td>
              <td class="mono-small">{{ r.runtime_h }}</td>

              <td class="mono-small">{{ r.completed }}</td>
              <td class="mono-small">{{ r.skipped }}</td>
              <td class="mono-small">{{ r.failed }}</td>

              <td class="history-view">
                <a class="btn primary" href="/history/{{ r.idx }}">View</a>
              </td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    {% endif %}

  </div>
</div>
{% endblock %}
