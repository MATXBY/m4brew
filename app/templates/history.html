{% extends "base.html" %}
{% block title %}m4brew • History{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{{ url_for('static', filename='history.css') }}">
{% endblock %}

{% block content %}
<div class="card">

  <div class="history-top">
    <a class="btn purple" href="/history/download">Download all</a>
    <form method="post" action="/history/clear" style="margin:0;">
      <button class="btn purple" type="submit">Clear history</button>
    </form>
  </div>

  {% if runs and runs|length %}
    <table>
      <thead>
        <tr>
          <th>Status</th>
          <th>When</th>
          <th>Mode</th>
          <th>Run type</th>
          <th>Runtime</th>
          <th>Completed</th>
          <th>Skipped</th>
          <th>Failed</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for r in runs %}
          <tr>
            <td>
              {% if r.get('success') %}
                <span class="status ok">✓</span>
              {% else %}
                <span class="status bad">×</span>
              {% endif %}
            </td>
            <td class="mono-small">{{ r.get('ts_human','') }}</td>
            <td class="mono-small">{{ r.get('mode_label', r.get('mode','')) }}</td>
            <td class="mono-small">{{ 'Test' if r.get('dry_run') else 'Active' }}</td>
            <td class="mono-small">{{ r.get('runtime_h','') }}</td>
            <td class="mono-small">{{ r.get('completed','') }}</td>
            <td class="mono-small">{{ r.get('skipped','') }}</td>
            <td class="mono-small">{{ r.get('failed','') }}</td>
            <td>
              <a class="btn purple" href="/history/{{ r.get('idx','') }}">View</a>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p class="muted">No history yet — run a job and it will appear here.</p>
  {% endif %}

</div>
{% endblock %}
